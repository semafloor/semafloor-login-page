<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="login-pages-theme.html">
<link rel="import" href="../iron-image/iron-image.html">
<link rel="import" href="../paper-ripple/paper-ripple.html">

<link rel="import" href="../neon-animation/neon-animations.html">

<link rel="import" href="../neon-animation/neon-shared-element-animatable-behavior.html">
<link rel="import" href="../neon-animation/animations/hero-animation.html">

<dom-module id="login-pages">
  <template strip-whitespace>
    <style include="login-pages-theme"></style>

    <div id="placeholder" class="fit"></div>

    <div id="loginPagesContainer" class="login-pages-container layout vertical flex-auto">
      <div class="product-image-container layout vertical center-center">
        <iron-image class="product-image" src="product_image_192.png" preload sizing="cover" fade></iron-image>
        <p class="product-brief-description">
          Lorem ipsum dolor sit amet, consectetur adipisicing elit. Praesentium iure odio nesciunt, sequi ut expedita.
        </p>
      </div>
      <div id="providerSelectionContainer" class="social-sites-container layout horizontal around-justified wrap"
        on-down="_iconDown" on-up="_iconUp">
        <iron-image class="facebook-icon"
          data-icon="facebook"
          src="social-sites-icons/facebook.png" preload sizing="cover" fade>
          <paper-ripple></paper-ripple>
        </iron-image>
        <iron-image class="twitter-icon"
          data-icon="twitter"
          src="social-sites-icons/twitter.png" preload sizing="cover" fade>
          <paper-ripple></paper-ripple>
        </iron-image>
        <iron-image class="gplus-icon"
          data-icon="gplus"
          src="social-sites-icons/gplus.png" preload sizing="cover" fade>
          <paper-ripple></paper-ripple>
        </iron-image>
        <iron-image class="github-icon"
          data-icon="github"
          src="social-sites-icons/github.png" preload sizing="cover" fade>
          <paper-ripple></paper-ripple>
        </iron-image>
        <iron-image class="email-icon"
          data-icon="email"
          src="social-sites-icons/email.png" preload sizing="cover" fade>
          <paper-ripple></paper-ripple>
        </iron-image>
      </div>
      <div class="create-new-account">
        <span>Don't have an account? </span>
        <paper-button class="sign-up-button" on-tap="_createNewAccount">Sign up</paper-button>
      </div>
    </div>

  </template>
  <script>
    Polymer({
      is: 'login-pages',

      behaviors: [Polymer.NeonSharedElementAnimatableBehavior],

      properties: {
        animationConfig: {
          value: function () {
            return {
              'entry': [{
                name: 'ripple-animation',
                id: 'infoToLogin',
                toPage: this
              }, {
                name: 'fade-out-animation',
                node: this.$.placeholder,
                timing: {
                  delay: 500,
                  duration: 0
                }
              }, {
                name: 'fade-in-animation',
                node: this.$.loginPagesContainer,
                timing: {
                  delay: 500,
                  duration: 100
                }
              }, {
                name: 'fade-in-animation',
                node: this.$.providerSelectionContainer,
                timing: {
                  delay: 550,
                  duration: 50
                }
              }],
              'exit': []
            }
          }
        },

        sharedElements: {
          value: function () {
            return {
              'infoToLogin': this.$.placeholder,
              'providerToLogin': this
            }
          }
        }
      },

      _iconDown: function (ev) {
        // console.log('icon-tap', ev);
        var _imgTarget = ev.target;

        while (_imgTarget && _imgTarget.tagName !== 'IRON-IMAGE') {
          _imgTarget = _imgTarget.parentElement;
        }

        if (_imgTarget) {
          this.set('animationConfig.exit', [{
            name: 'fade-out-animation',
            node: this
          }, {
            name: 'hero-animation',
            id: 'loginToProvider',
            fromPage: this
          }]);
          this.set('sharedElements.loginToProvider', ev.target.parentElement);
          _imgTarget.classList.add('pressed');
        }
      },

      _iconUp: function (ev) {
        // console.log(this.sharedElements);
        var _imgTarget = ev.target, _iconName;

        while (_imgTarget && _imgTarget.tagName !== 'IRON-IMAGE') {
          _imgTarget = _imgTarget.parentElement;
        }

        if (_imgTarget && _imgTarget.hasAttribute('data-icon')) {
          _iconName = _imgTarget.getAttribute('data-icon');
          // console.log(_imgTarget);
          _imgTarget.classList.remove('pressed');
          this.set('animationConfig.entry', []);
          this.fire('show-provider-login', {provider: _iconName});
        }
      },

      updateAnimationConfigFromProviderToLogin: function (_providerName) {
        this.animationConfig.entry.push({
          name: 'hero-animation',
          id: 'providerToLogin',
          toPage: this
        }, {
          name: 'fade-in-animation',
          node: this
        });
      },

      _createNewAccount: function (ev) {
        var _target = ev.target;

        while (_target && _target.tagName !== 'PAPER-BUTTON') {
          _target = _target.parentElement;
        }

        this.fire('show-signup-page');
      }

    });
  </script>
</dom-module>
