<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="provider-login-page-theme.html">

<link rel="import" href="../paper-scroll-header-panel/paper-scroll-header-panel.html">
<link rel="import" href="../paper-toolbar/paper-toolbar.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-checkbox/paper-checkbox.html">
<link rel="import" href="../paper-fab/paper-fab.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">

<link rel="import" href="../iron-image/iron-image.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-form/iron-form.html">

<link rel="import" href="../neon-animation/neon-animations.html">

<link rel="import" href="../neon-animation/neon-shared-element-animatable-behavior.html">
<link rel="import" href="../neon-animation/animations/hero-animation.html">

<dom-module id="provider-login-page">
  <template>
    <style include="provider-login-page-theme"></style>

    <paper-scroll-header-panel id="providerScrollHeaderPanel" class$="flex [[_providerCls]]" mode="waterfall">
      <paper-toolbar id="providerToolbar" class$="paper-header tall toolbar-for-[[_providerCls]]">
        <div class="icon-background">
          <div class$="icon-background-inset[[_gplusSpecial]]"></div>
        </div>
        <iron-image id="facebokToolbar" class$="[[_providerCls]]-icon"
          data-icon="[[_providerCls]]"
          src$="../social-sites-icons/[[_providerCls]].png" sizing="cover" fade>
        </iron-image>

        <div class="flex-auto"></div>
        <paper-icon-button icon="icons:close" on-tap="_goBackLoginPages"></paper-icon-button>

        <div class="provider-name bottom">
          <span>[[providerName]]</span>
        </div>
      </paper-toolbar>

      <div id="providerContent" class="content provider-content">
        <p>
          Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci minima natus architecto molestiae, corrupti debitis vitae eveniet dicta. Eligendi, accusamus.
        </p>
        <form id="providerForm" is="iron-form" class="provider-login-form"
          action="index.html" method="post">
          <paper-input name="email" label="Email Address"
            type="text"
            auto-validate
            required
            error-message="Invalid Email Address!"
            pattern="\w\S+@\w\S+\.\S+"></paper-input>
          <paper-input name="password" label="Password"
            type="password"
            auto-validate
            required error-message="Password required!"></paper-input>
          <paper-checkbox name="remember">Login Automatically</paper-checkbox>
        </form>
        <div class="layout horizontal center-center paper-fab-container">
          <paper-fab class$="submit-form-to-login [[_providerCls]]" icon="icons:send" mini on-tap="_submitFormToLogin" on-transitionend="_transitionendAction"></paper-fab>
        </div>
      </div>
    </paper-scroll-header-panel>

  </template>
  <script>
    Polymer({
      is: 'provider-login-page',

      behaviors: [Polymer.NeonSharedElementAnimatableBehavior],

      properties: {
        providerName: {
          type: String,
        },
        animationConfig: {
          value: function() {
            return {
              'entry': [{
                name: 'hero-animation',
                id: 'loginToProvider',
                toPage: this
              }, {
                name: 'fade-in-animation',
                node: this.$.providerToolbar,
                timing: {
                  // duration: 1000
                }
              }, {
                name: 'fade-in-animation',
                node: this.$.providerContent,
                timing: {
                  delay: 100,
                  // duration: 1000
                }
              }],
              'exit': [{
                name: 'hero-animation',
                id: 'providerToLogin',
                fromPage: this
              }, {
                name: 'fade-out-animation',
                node: this.$.providerToolbar,
                timing: {
                  delay: 0,
                  duration: 0
                }
              }, {
                name: 'fade-out-animation',
                node: this,
                timing: {
                  delay: 0,
                  duration: 0
                }
              }]
            }
          }
        },
        sharedElements: {
          value: function () {
            return {
              'loginToProvider': this.$.providerToolbar,
              'providerToLogin': this.$.providerToolbar
            }
          }
        },

        _providerCls: {
          type: String,
          computed: '_computedProviderCls(providerName)'
        },
        _isFacebook: {
          type: Boolean,
          value: false
        },
        _isTwitter: {
          type: Boolean,
          value: false
        },
        _isGplus: {
          type: Boolean,
          value: false
        },
        _isGithub: {
          type: Boolean,
          value: false
        },
        _isEmail: {
          type: Boolean,
          value: false
        },

        _hasTransitionended: Boolean,
        _oldProviderName: String,
        _gplusSpecial: String,

      },

      listeners: {
        'iron-form-presubmit': '_onIronFormPresubmit'
      },

      _computedProviderCls: function(_providerName) {
        // always reset the providerName value.
        this._resetProvider();
        console.log('you must run this everytime!!!', _providerName);
        this.set('_gplusSpecial', '');
        switch (_providerName) {
          case 'facebook':
            this.set('_isFacebook', true);
            break;
          case 'twitter':
            this.set('_isTwitter', true);
            break;
          case 'gplus':
            this.set('_gplusSpecial', ' gplus-special')
            this.set('_isGplus', true);
            break;
          case 'github':
            this.set('_isGithub', true);
            break;
          case 'email':
            this.set('_isEmail', true);
            break;
          default:

        }
        return _providerName;
      },

      _goBackLoginPages: function (ev) {
        this.fire('show-login-pages', {fromPage: this.providerName});
      },

      _resetProvider: function () {
        this.set('_isFacebook', false);
        this.set('_isTwitter', false);
        this.set('_isGplus', false);
        this.set('_isGithub', false);
        this.set('_isEmail', false);
      },

      _submitFormToLogin: function (ev) {
        this.set('_hasTransitionended', false);
      },

      _onIronFormPresubmit: function (ev) {
        console.log(ev.target.request.body);
        ev.preventDefault();
      },

      _transitionendAction: function (ev) {
        // to counter transitionend inside transitionend.
        var _target = ev.target;

        if (_target && _target.tagName === 'PAPER-FAB') {
          if (!this._hasTransitionended) {
            this.set('_hasTransitionended', true);
            this.$.providerForm.submit();
            console.log(ev);
            console.log(this.$.providerForm.request.body);
          }
        }
      },

      measureHeaderHeight: function () {
        this.$.providerScrollHeaderPanel.measureHeaderHeight();
      },

    });
  </script>
</dom-module>
